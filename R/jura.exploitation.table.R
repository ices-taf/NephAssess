jura.exploitation.table<- function(wk.dir, neph.obj, f.u, bias, years, survey, scottish.land, clyde.discard.rates)
{


####Jura

survey.data <-read.csv(survey, header=TRUE, sep = ",") 
survey.data<- subset(survey.data, year>=years[1])
scottish.landings<- read.csv(scottish.land, header=TRUE, sep = ",")[,c("Year", "Total")]
scottish.landings<- scottish.landings[scottish.landings$Year %in% years, "Total"]
cl.rates<- read.csv(clyde.discard.rates, header=TRUE, sep = ",")
cl.disc.rate<- subset(cl.rates, year %in% years)$clyde.discard.rate
cl.dead.disc.rate<- subset(cl.rates, year %in% years)$clyde.dead.discard.rate

stock <- trim(neph.obj,year=years)

landings.n<- seasonSums(quantSums(unitSums(stock@landings.n)))

#mean.wt<- c(16.9,	15.5, 15.0,	19.0,	21.6,	25.6)
mean.wt<- mean.weight2(stock.list=list(neph.obj))[,2]

#raising.factor<- scottish.landings*1000 / (seasonSums(quantSums(unitSums(stock@landings.n))) * as.vector(mean.wt))
raising.factor<- scottish.landings*1000 / seasonSums(quantSums(unitSums(stock@landings.n*stock@landings.wt*1000)))

landings.n.raised<- raising.factor*landings.n
    
scot.removals <-seasonSums(quantSums(unitSums(stock@landings.n))) * raising.factor

#discards.n<- scot.removals * cl.disc.rate/100
#rem<- 0.75*discards.n
#scot.removals + rem			#total removals? Check which is more correct?


scot.removals <- scot.removals*(100/(100-cl.dead.disc.rate))	#add discards 	 0.4 discard rate	cl.disc.rate



int.landings<- scottish.landings
int.removals <- scot.removals  

HR <-int.removals/(1000*round(survey.data$abundance/bias,0))

tmp <-cbind(year=survey.data$year,
				landings.numbers = round(landings.n.raised/1000, 1),				#millions
				removals.numbers = round(int.removals/1000, 1),
				adjusted.abundance = round(survey.data$abundance/bias, 0),		#millions
				harvest.ratio = round(HR*100, 1),
				landings.tonnes = int.landings,
				discard.rate = cl.disc.rate,
				#mean.wt.landings = round(as.vector(mean.wt), 2),
				dead.discard.rate = cl.dead.disc.rate)
    
write.table(tmp, paste(wk.dir, "/", f.u, "_Exploitation summary.csv", sep = ""), row.names=FALSE, sep =",")
}






mean.weight.landings<- function(neph.object)
{

	male.a   <- 0.00028
	male.b   <- 3.24
	female.a <- 0.00074
	female.b <- 2.91

	lcats <- round(seq(9,71, by=2), digits=0)
	lens  <- c(9:71)
	landings.end.year<- max(as.numeric(colnames(neph.object@landings.n[,,,,,])))
	landings.start.year<- min(as.numeric(colnames(neph.object@landings.n[,,,,,])))

	mean.landings<- FLQuant(dimnames=list(lengths=seq(9,71, by=2), year = landings.start.year:landings.end.year,
                    unit = c("Male", "Female"), area = neph.object@name))
	
	mean.landings[,,1,,,]<- neph.object@landings.n[,,1,1,,] + neph.object@landings.n[,,1,2,,] + neph.object@landings.n[,,1,3,,] + neph.object@landings.n[,,1,4,,]
	mean.landings[,,2,,,]<- neph.object@landings.n[,,2,1,,] + neph.object@landings.n[,,2,2,,] + neph.object@landings.n[,,2,3,,] + neph.object@landings.n[,,2,4,,]


	individual.weights<- FLQuant(dimnames=list(lengths=seq(9,71, by=2), year = landings.start.year:landings.end.year,
                    unit = c("Male", "Female"), area = neph.object@name))
 
	for (y in (1:(landings.end.year-landings.start.year+1)))
	{
		for (l in (1:32))
		{
			individual.weights[l,y,1,,] <- (male.a*((lcats[l]+1)^male.b))
			individual.weights[l,y,2,,] <- (female.a*((lcats[l]+1)^female.b))
		}
	}

	mean.weights.combined<- colSums((mean.landings[,,1,,,] * individual.weights[,,1,,,]) + (mean.landings[,,2,,,] * individual.weights[,,2,,,])) / 
		colSums(mean.landings[,,1,,,] + mean.landings[,,2,,,])

	return(mean.weights.combined)
		
}